Ubiquiti Inform Protocol
========================

The mFi uses the Ubiquiti inform protocol to handle all communications to and
from the controller. This is the way that it transmits the current state of the
system to the controller (looks like it just sends mca-dump output) as well as
how it receives the instructions from the controller as to what to enable or
disable.

Everything appears to be pull-based, even provisioning. This makes sense with
the cloud controller where the controller has no access to your network. I
haven't documented yet how anything works within the protocol, that's next.
This documents the overall procol itself.


Packet Structure
----------------
4 bytes          magic number            integer
4 bytes          version                 integer
6 bytes          hwaddr                  string
2 bytes          flags                   short
16 bytes         initialization vector   string
4 bytes          data version            integer
4 bytes          data length             integer
n bytes          encrypted payload       string


magic must == 1414414933
data version must < 1
flags & 0x1 != 0 means encrypted
flags & 0x2 != 0 means compressed


The payload is AES encrypted in CBC mode using PKCS5 padding. They key is the
device auth key from the database or a master key that is hard coded if the
device hasn't been provisioned yet. The master key is hard coded in the
controller code in the DeviceManager class and pretty easy to find.

On devices running protocol version 1 the encrypted payload is just JSON data.
In version 0 of the protocol the data was key=value pairs separated by
newlines. All of the mFi hardware I have access to uses protocol version 1.

MASTER_KEY = "ba86f2bbe107c7c57eb5f2690775c712"
